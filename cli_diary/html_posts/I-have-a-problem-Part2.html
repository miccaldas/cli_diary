<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>I Have a Problem Part2</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #cccccc; background-color: #303030; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ffcfaf; } /* Alert */
    code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
    code span.at { } /* Attribute */
    code span.bn { color: #dca3a3; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #f0dfaf; } /* ControlFlow */
    code span.ch { color: #dca3a3; } /* Char */
    code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
    code span.co { color: #7f9f7f; } /* Comment */
    code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
    code span.do { color: #7f9f7f; } /* Documentation */
    code span.dt { color: #dfdfbf; } /* DataType */
    code span.dv { color: #dcdccc; } /* DecVal */
    code span.er { color: #c3bf9f; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #c0bed1; } /* Float */
    code span.fu { color: #efef8f; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
    code span.kw { color: #f0dfaf; } /* Keyword */
    code span.op { color: #f0efd0; } /* Operator */
    code span.ot { color: #efef8f; } /* Other */
    code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
    code span.sc { color: #dca3a3; } /* SpecialChar */
    code span.ss { color: #cc9393; } /* SpecialString */
    code span.st { color: #cc9393; } /* String */
    code span.va { } /* Variable */
    code span.vs { color: #cc9393; } /* VerbatimString */
    code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">I Have a Problem Part2</h1>
<p class="date">2021-01-30T23:08:08Z</p>
</header>
<p>New news on the database and table automation front. None of them good. After a strong beginning, as told in the update to the first part of this series, I reached another deadlock, two actually:</p>
<ol type="1">
<li>How to unpack dictionary items to free standing variables,<br />
</li>
<li>How to automate the string manipulations necessary for transforming the received input into a SQL query that SQLite accepts.</li>
</ol>
<p>In regards to the collecting the information from the user, I have the following set-up:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> collect_data():  </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    db_name <span class="op">=</span> <span class="bu">input</span>(color(<span class="st">&#39;What name do you want for the database? &#39;</span>, fore<span class="op">=</span><span class="st">&#39;#585a47&#39;</span>))</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    table_name <span class="op">=</span> <span class="bu">input</span>(color(<span class="st">&#39;What name do you want for the table? &#39;</span>, fore<span class="op">=</span><span class="st">&#39;#585a47&#39;</span>))</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> collections.OrderedDict()</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    col_num <span class="op">=</span> <span class="bu">int</span>(<span class="bu">input</span>(color(<span class="st">&#39;How many columns will you need? &#39;</span>, fore<span class="op">=</span><span class="st">&#39;#ff6f69&#39;</span>)))</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> y <span class="kw">in</span> <span class="bu">range</span>(col_num):</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        col_name <span class="op">=</span> <span class="bu">input</span>(color(<span class="st">&#39;What is the name of your column? &#39;</span>, fore<span class="op">=</span><span class="st">&#39;#ff6f69&#39;</span>))</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>        key <span class="op">=</span> col_name</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>        a.setdefault(key, [])</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        att_num <span class="op">=</span> <span class="bu">int</span>(<span class="bu">input</span>(color(<span class="st">&#39;How many attributes will you need? &#39;</span>, fore<span class="op">=</span><span class="st">&#39;#ff6f69&#39;</span>)))</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(att_num):</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>            att_name <span class="op">=</span> <span class="bu">input</span>(color(<span class="st">&#39;What is the name of your attribute? &#39;</span>, fore<span class="op">=</span><span class="st">&#39;#ff6f69&#39;</span>))</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>            a[key].append(att_name)</span></code></pre></div>
<p>As you can see, in order to steer clear of the long, repetitive lists from my first attempt, I managed to encapsulate all needed questions and answers in the very compact set of lines. And that pleases me to no end. But what I didn’t considered this time, is that by using loops, I can’t isolate in variables, each iteration of the loop. I can access them as data points inside a dictionary; but that doesn’t give me the freedom that I need to manipulate the answers strings to serve SQL query.<br />
At the same time, I ask myself if I’m wrong about this. That the dictionaries methods are enough for me to pass all necessary information to the query. But if it is, I haven’t been smart enough to figure it it out.<br />
The thing is this: The output I currently get, explaining what columns to use and what attributes they’ll have, has the following aspect.<br />
This is for a test table which would have the following structure:</p>
<ol type="1">
<li>Column Name: ‘ID’ Column Attributes: INT, NOT NULL, PRIMARY KEY,<br />
</li>
<li>Column Name: ‘Title’ Column Attributes: TEXT,<br />
</li>
<li>Column Name: ‘Link’ Column Attributes: TEXT</li>
</ol>
<p>For it to become an acceptable query, it will have to have this format:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> <span class="op">&lt;</span>table_name<span class="op">&gt;</span>( <span class="kw">id</span> <span class="dt">INT</span> <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">PRIMARY</span> <span class="kw">KEY</span>, title TEXT, <span class="kw">link</span> TEXT)</span></code></pre></div>
<p>And this is how I’m getting the information from the questions processing function:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>OrderedDict([(<span class="st">&#39;id&#39;</span>, [<span class="st">&#39;int&#39;</span>, <span class="st">&#39;not null&#39;</span>, <span class="st">&#39;primary key&#39;</span>]), (<span class="st">&#39;title&#39;</span>, [<span class="st">&#39;text&#39;</span>]), (<span class="st">&#39;link&#39;</span>, [<span class="st">&#39;text&#39;</span>])])</span></code></pre></div>
<p>A few things about this; the ‘OrderedDict’ is a string that comes from creating this dictionary as an <a href="https://docs.python.org/3/library/collections.html#collections.OrderedDict">ordered dictionary</a>, a type of dictionary that has some item manipulations methods that seemed interesting to me. For one the order in what the items were inputted is remembered, and it doesn’t change from one invocation to another, as it happens in the other dictionaries.<br />
So, for the sake of argument, let’s imagine that I’m right, (oh, in what shaky foundations we build this reasoning!), and that there is the need to free the information from its dictionary prison. In that case we have to embark in a series of alterations to this output, for it to be accepted by SQLite.<br />
My first problem is all the punctuation that has to go. At this moment, If I ask how many elements are in that string, the answer is 3:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fl">1.</span> [(<span class="st">&#39;id&#39;</span>, [<span class="st">&#39;int&#39;</span>, <span class="st">&#39;not null&#39;</span>, <span class="st">&#39;primary key&#39;</span>]),</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fl">2.</span> (<span class="st">&#39;title&#39;</span>, [<span class="st">&#39;text&#39;</span>]),</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fl">3.</span> (<span class="st">&#39;link&#39;</span>, [<span class="st">&#39;text&#39;</span>])</span></code></pre></div>
<p>So I need to eliminate all the python syntax symbols.<br />
To do that, I did the following operations:</p>
<ol type="1">
<li>Transform the output into a list. In order to be able to access elements individually, is necessary to turn the items from the dictionary into a list. So we create a list called ‘items’, with all it’s content. ‘Item’ refers to a key:value pair.<br />
</li>
</ol>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>items <span class="op">=</span> <span class="bu">list</span>(a.items())  </span></code></pre></div>
<ol start="2" type="1">
<li>Create a empty list to house the transformed values we will create.<br />
</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> []</span></code></pre></div>
<ol start="3" type="1">
<li>Create a loop where we’ll iterate through the items and subject them to several manipulations:<br />
</li>
</ol>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> items:</span></code></pre></div>
<ol start="4" type="1">
<li>Create a new variable to house the transformation from a list into a string. The new variable is needed for reasons of clarity and it will be necessary when doing the string manipulations, as strings are immutable, each alteration creates a new string. The reason to turn it to a string is because all the methods that I know of changing characters, are string methods. If I’m wrong, please tell me, as this is not the most comfortable of environments.<br />
</li>
</ol>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>ita <span class="op">=</span> <span class="bu">str</span>(i)</span></code></pre></div>
<ol start="5" type="1">
<li>Now we clean the output of the “()[]’” characters.<br />
</li>
</ol>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>itb <span class="op">=</span> ita.translate({<span class="bu">ord</span>(i): <span class="va">None</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="st">&quot;()[]&#39;&quot;</span>})</span></code></pre></div>
<ol start="6" type="1">
<li>We separate the items in different units, using the commas as measurements where to cut.<br />
</li>
</ol>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>itc <span class="op">=</span> itb.split(<span class="st">&#39;,&#39;</span>)</span></code></pre></div>
<ol start="7" type="1">
<li>We cleave the first element of this separated string and keep it in a list. It is the first columns name. Now that I’m looking back at this, I think that this step is superfluous, but I’ll leave it, to document what I’ve done. Warts and all.<br />
</li>
</ol>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>itd <span class="op">=</span> itc[<span class="dv">0</span>]</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>results.append(itd)</span></code></pre></div>
<ol start="8" type="1">
<li>Now we separate the rest of the column specifications (its attributes), in another variable.<br />
</li>
</ol>
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>ite <span class="op">=</span> itc[<span class="dv">1</span>:]</span></code></pre></div>
<ol start="9" type="1">
<li>And we turn it into a string.<br />
</li>
</ol>
<div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>itf <span class="op">=</span> <span class="bu">str</span>(ite)</span></code></pre></div>
<ol start="10" type="1">
<li>Now we clean this output of the characters, “[],’”.<br />
</li>
</ol>
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>itg <span class="op">=</span> itf.translate({<span class="bu">ord</span>(i): <span class="va">None</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="st">&quot;[],&#39;&quot;</span>})</span></code></pre></div>
<ol start="11" type="1">
<li>And turn their characters into uppercase. It’s not really needed but, it’s a SQL convention that I honor because it makes the output more legible. Then we append it to the list.<br />
</li>
</ol>
<div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>ith <span class="op">=</span> itg.upper()</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>results.append(ith)</span></code></pre></div>
<ol start="12" type="1">
<li>Now for the creation of the query. We start with the beginning of the query in a string. The rest will be added when we insert the values.<br />
</li>
</ol>
<div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>query1 <span class="op">=</span> <span class="st">&#39;CREATE TABLE &#39;</span> <span class="op">+</span> table_name <span class="op">+</span> <span class="st">&#39;(&#39;</span></span></code></pre></div>
<ol start="13" type="1">
<li>Now we iterate through the list were we saved our variables, and add them some punctuation needed to build the query. And we’re done.<br />
</li>
</ol>
<div class="sourceCode" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> result <span class="kw">in</span> results:</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    query1 <span class="op">+=</span> result <span class="op">+</span> <span class="st">&#39; &#39;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>query2 <span class="op">=</span> query1 <span class="op">+</span> <span class="st">&#39;)&#39;</span></span></code></pre></div>
<p>The resulting output is this:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> cards(<span class="kw">id</span>  <span class="dt">INT</span>  <span class="kw">NOT</span> <span class="kw">NULL</span>  <span class="kw">PRIMARY</span> <span class="kw">KEY</span> title  TEXT <span class="kw">link</span>  TEXT )</span></code></pre></div>
<p>And I observe that, after all this, we still have configuration problems.<br />
The command lacks two commas that are fundamental. I know this because I tried to sent it as is (trusting that the Gods of SQL were with me), and it didn’t work. What is needed is a comma after ‘PRIMARY KEY’, and another after the first ‘TEXT’. Like this.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> cards(<span class="kw">id</span>  <span class="dt">INT</span>  <span class="kw">NOT</span> <span class="kw">NULL</span>  <span class="kw">PRIMARY</span> <span class="kw">KEY</span>, title  TEXT, <span class="kw">link</span>  TEXT )</span></code></pre></div>
<p>And this is where I get into trouble.<br />
Remember that we’re dealing with a string, so any attempt at indexing has to take into account that, the there is an index for each character and space in the query. There are, now, no concepts like three elements, each indexed with its own tag.<br />
Now, if we want to manipulate the string we’ll have to think character by character.<br />
But that would be a wasted effort. The places were we want to put our commas will be in the different indexes every time a new table is built. There’s no way to guarantee that every time, at that location, will be the end of ‘PRIMARY KEY’, for example.<br />
So I looked for methods that would delete characters by their recurrence or by type.<br />
I tried this function I found in Stack Overflow:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a> <span class="kw">def</span> nth_repl(s, sub, repl, n):</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    find <span class="op">=</span> s.find(sub)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If find is not -1 we have found at least one match for the substring</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> find <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># loop until we find the nth or we find no match</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> find <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span> <span class="kw">and</span> i <span class="op">!=</span> n:</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># find + 1 means we start searching from after the last match</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>        find <span class="op">=</span> s.find(sub, find <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>        i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If i is equal to n we found nth match so replace</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">==</span> n:</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> s[:find] <span class="op">+</span> repl <span class="op">+</span> s[find<span class="op">+</span><span class="bu">len</span>(sub):]</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> s</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a> s <span class="op">=</span> <span class="bu">str</span>(results)</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a> s1 <span class="op">=</span> nth_repl(s, <span class="st">&#39;,&#39;</span>, <span class="st">&#39;&#39;</span>, <span class="dv">1</span>) <span class="co"># Replaces 1st occurrence of a comma</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a> s2 <span class="op">=</span> nth_repl(s1, <span class="st">&#39;,&#39;</span>, <span class="st">&#39;&#39;</span>, <span class="dv">2</span>)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a> s3 <span class="op">=</span> nth_repl(s2, <span class="st">&#39;,&#39;</span>, <span class="st">&#39;&#39;</span>, <span class="dv">3</span>)</span></code></pre></div>
<p>It didn’t work. Don’t know why. It should have worked. But the fucking commas were still there, after each attempt I did.<br />
I tried to get there by skipping every other comma in the query. Like so:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(a), <span class="dv">2</span>):</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> <span class="st">&#39;CREATE TABLE cards(id  INT  NOT NULL  PRIMARY KEY title  TEXT link  TEXT )&#39;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    s1 <span class="op">=</span> s.replace(<span class="st">&#39;a&#39;</span>, <span class="st">&#39;&#39;</span>))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(s1)</span></code></pre></div>
<p>The idea was to insert a command every two iterations of the loop, to coincide with the end of the attribute definitions, that would write a comma. But in the output, the commas came before the rest of the content.<br />
I tried to add a comma to the values when they are inserted into to the list, but this only compounded the problems, not solved it.<br />
But no luck, I never seemed to be on the commas I wanted to eliminate.<br />
There was other stuff I tried or thought about. For instance, removing all the commas with ‘translate’ and then put only the ones I needed. Like so:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> <span class="st">&#39;abc12321cba&#39;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(s.translate({<span class="bu">ord</span>(<span class="st">&#39;a&#39;</span>): <span class="va">None</span>}))</span></code></pre></div>
<p>But this would only take from a place where I had too many commas, to another, where I didn’t have enough.<br />
At this point in time, I’m too tired and burnt out to think about this issue anymore. I’ll leave it alone for a few days and come back, hopefully, with another attitude. As it was clear that I was getting nowhere in this direction, I thought to change the paradigm. What if instead of taking the loop values directly to the query, we would put them first in variables, and then from those well defined, clean variables, build a SQL expression.<br />
This was closer to my original idea, (which, if ugly as hell, it’s still the one that works best, from all those that i came up with.), to declare all variables out loud, and go from there. As I am acutely aware of the horrible, horrible code that that approach begets, I tried to find a middle ground.<br />
My idea was to create variables for each data item after leaving the loop, and create the query from them.<br />
The problem that I faced, and that seems to me, as complex as the latter, is how to name variables that would be created automatically in a loop?<br />
All that I read about this was how a terrible idea this is, and that we would be much better served if we created a dictionary.<br />
Well, I have a dictionary, what I need is to free myself from it!<br />
And here, again, slouches the old doubt, do I know enough about python dictionaries to say that this can’t be done with their methods?<br />
Although how I don’t have an inkling how I would go about doing it, there’s always a nagging feeling in the back of my brain, telling me that this enormous problem is fruit of my ignorance, and that this could be solved with less coding and more studying. Which, even if true, would turn this endeavor into a massive chore. I have a lot of difficulties concentrating in a task where I’m not actively involved. To sit and absorb, doesn’t come easy to me. And yes, I had a lovely time at school, as you might imagine. But I tried not be dissuaded by voices that, however well-meaning and informed, were explaining a problem that I didn’t fully understand and, most important, didn’t address my most urgent concern; how to solve MY problem.<br />
So I tried to build the variables by globals():</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">9</span>):</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">globals</span>()[<span class="st">&#39;key_</span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(key)] <span class="op">=</span> <span class="st">&#39;a&#39;</span></span></code></pre></div>
<p>but find it too cumbersome to be of any real value. I tried also to build them through exec and in this particular instance, couldn’t get it to work.<br />
I’m keenly aware as I write these words that, these difficulties, may not be intrinsic to the problem, but fruit of my own stupidity and ignorance.<br />
Which makes me second guess myself even more. What, if you knew me, would know that is a lot.<br />
I’m mainly writing these words in the hope that this is seen by someone that can help, or just say Hi!, but also in an effort to, through writing, get a clearer understanding of the problem. Most of the time I navigate in a hazy dark soup of half-arsed intuitions and scraps of things I read online, and it feels like this all process needs more clarity and definition.<br />
Hence this blog. And these words of mine; to you.</p>
</body>
</html>

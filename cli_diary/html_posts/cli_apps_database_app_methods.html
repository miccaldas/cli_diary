<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Cli Apps Database App. Methods</title>
  <style>
    html {
      font-family: Iosevka;
      font-size: 13pt;
      color: #1a1a1a;
      background-color: #fdfdfd;
      line-height: 1.5;
    }
    body {
      margin: 0 auto;
      max-width: 45em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
     pre.sourceCode { margin: 1em; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #cccccc; background-color: #303030; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ffcfaf; } /* Alert */
    code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
    code span.at { } /* Attribute */
    code span.bn { color: #dca3a3; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #f0dfaf; } /* ControlFlow */
    code span.ch { color: #dca3a3; } /* Char */
    code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
    code span.co { color: #7f9f7f; } /* Comment */
    code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
    code span.do { color: #7f9f7f; } /* Documentation */
    code span.dt { color: #dfdfbf; } /* DataType */
    code span.dv { color: #dcdccc; } /* DecVal */
    code span.er { color: #c3bf9f; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #c0bed1; } /* Float */
    code span.fu { color: #efef8f; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
    code span.kw { color: #f0dfaf; } /* Keyword */
    code span.op { color: #f0efd0; } /* Operator */
    code span.ot { color: #efef8f; } /* Other */
    code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
    code span.sc { color: #dca3a3; } /* SpecialChar */
    code span.ss { color: #cc9393; } /* SpecialString */
    code span.st { color: #cc9393; } /* String */
    code span.va { } /* Variable */
    code span.vs { color: #cc9393; } /* VerbatimString */
    code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Cli Apps Database App. Methods</h1>
<p class="date">08-08-2023 13:33</p>
</header>
<p>I realized now that I left something unsaid. I didn’t speak on the
lowly helper methods, that help to shape the loops and the initial
process.<br />
Some you already know, as the ones that compose the initial processing
of information, but there are two or three I didn’t mentioned. This is
their time.</p>
<h4>
<u>input_decision</u>
</h4>
<p>This small function, and the next that’s even smaller, proved
themselves so useful and versatile that, if I’m not transplanting them
as they are, they deeply inspired me to create their more generalist
cousins, to use in other projects.<br />
Although I’m using mostly <em>Rich</em> to format the output, their
<code>input</code> solution is shit. First the prompt appears a line
below the prompt text and second, it’s completely squashed against the
left margin of the terminal wall. I don’t know if it’s like this on
purpose or if I’m missing something. But as it is, I’m not using
it.<br />
Instead I used <code>click.style</code>. A known quantity, that never
disappoints.<br />
As you can see, you can change the prompt text and color of the
string.<br />
What more do you need?</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> input_decision(prompt, color<span class="op">=</span>(<span class="dv">160</span>, <span class="dv">196</span>, <span class="dv">157</span>)):</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Template for inputs, asking the user</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">    for a decision. &#39;Rich&#39; doesn&#39;t work</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">    correctly with input. Has to be &#39;click&#39;.</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    dec <span class="op">=</span> <span class="bu">input</span>(</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        style(</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;          </span><span class="sc">{</span>prompt<span class="sc">}</span><span class="ss"> &quot;</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>            <span class="co"># fg=color,</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>            bold<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> dec</span></code></pre></div>
<h4>
<u>print_template</u>
</h4>
<p>Now comes a very similar concept, but for printing strings. Here,
because it’s simpler, we can use <em>Rich</em> again.</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_template(text, style<span class="op">=</span><span class="st">&quot;bold #AAC8A7&quot;</span>):</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Template to format string presentation.</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    console <span class="op">=</span> Console()</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    console.<span class="bu">print</span>(Padding(<span class="ss">f&quot;[</span><span class="sc">{</span>style<span class="sc">}</span><span class="ss">][+] - </span><span class="sc">{</span>text<span class="sc">}</span><span class="ss">[/]&quot;</span>, (<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">10</span>)))</span></code></pre></div>
<h4>
<u>subcall</u>
</h4>
<p>This is meatier terrain. Although gradually and in baby steps.<br />
The two functions after this one, <code>yay_info()</code> and
<code>pip_info()</code>, have a lot of subprocess operations, all very
much alike. This function, creates a template that simplifies the
creation of the command.<br />
It basically uses the commands <code>yay -Qi</code> and
<code>pip show</code>, both information queries of their respective
databases, to get data on the packages chosen by the user. So it’s just
a matter of asking a question and sending it to a text file.<br />
The components are:</p>
<ol type="1">
<li><strong><code>shellcmd</code></strong> - This can be a <em>yay</em>
or <em>pip</em> command.<br />
</li>
<li><strong><code>flnm</code></strong> - The name of the file.<br />
</li>
<li><strong><code>fldr</code></strong> - Folder name. Could be
<em>data_files</em> or <em>required_files</em>.<br />
</li>
<li><strong><code>flnmid</code></strong> - A prefix indicating if it
comes from <em>yay</em> or <em>pip</em>.<br />
</li>
<li><strong><code>stderr</code></strong> - Both apps produce error
outputs that can be, both, informative and excessive. Sometimes stderr
will go to a file, others to <code>/dev/null</code>.</li>
</ol>
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> subcall(shellcmd, flnm, fldr, flnmid, stderr):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Makes &#39;subprocess&#39; calls for &#39;yay_info&#39;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">    and &#39;pip_info&#39;. To simplify the code.</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    da <span class="op">=</span> os.getenv(<span class="st">&quot;DA&quot;</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    cmd <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>shellcmd<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>flnm<span class="sc">}</span><span class="ss"> &gt; </span><span class="sc">{</span>fldr<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>flnm<span class="sc">}{</span>flnmid<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>stderr<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    subprocess.run(cmd, cwd<span class="op">=</span>da, shell<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<h4>
<u>yay_info</u>
</h4>
<p>Extracts information from the <code>yay -Qi</code> command.<br />
Although this may seem trivial at first, it has a set of small details,
that make it much more complex than I initially anticipated. On the
bright side, it has shown to be trustworthy and reliable. For which I’m
grateful.<br />
As usual, there’s a lot of comments to guide through it, but maybe just
a word or two on the fact that; because there needs to be two data
folders and that some loops start in one and end in another; it’s
important always to refer what folder we are using. As you do different
things in different places. Because of this, all information that comes
through this data gathering functions, comes tagged with a reference to
the destination folder. This information may be important to understand
some of the comments.</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> yay_info(srch):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Module to extract information on</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">    packages from &#39;yay&#39;. There are</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">    several types of input that come</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">    to this function, if it comes</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">    from fzf, its a string that needs</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">    to be evaluated to a list, if it</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">    comes from &#39;required_by&#39;, it could</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">    a string or a list of strings.</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    da <span class="op">=</span> os.getenv(<span class="st">&quot;DA&quot;</span>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    shellcmd <span class="op">=</span> <span class="st">&quot;yay -Qi&quot;</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># This sends stderr output to a file. The initial reason for this was</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Pip&#39;s penchant for outputting an enormous quantity of warning messages</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># when you call &#39;pip show&#39;. To hide it, the first thought was to send it</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># to /dev/null. Then I thought that, in the midst of the spurious messages,</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># could be something that&#39;s important. Besides, I don&#39;t want to loose yay&#39;s</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># output. So a text file it is.</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    stderr <span class="op">=</span> <span class="st">&quot; 2&gt;&gt; error_files/yay_stderr.txt&quot;</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If &#39;srch&#39; comes from &#39;srch_allinfo&#39;, will need to evaluate the</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># output, as &#39;fzf&#39; presents a list as a string. To id it,</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># &#39;srch_allinfo&#39; adds, at the end of &#39;srch&#39;, the string &#39;ai&#39;.</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># This means the format of &#39;srch&#39; in this case is two element tuple</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># with a list of tuples in string format as its first element, and</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the code &#39;ai&#39; as its second.</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> srch[<span class="op">-</span><span class="dv">1</span>] <span class="op">==</span> <span class="st">&quot;ai&quot;</span>:</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>        fldr <span class="op">=</span> <span class="st">&quot;data_files&quot;</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>        datapth <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>da<span class="sc">}{</span>fldr<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>        flnmid <span class="op">=</span> <span class="st">&quot;_yay&quot;</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># This deletes the contents of &#39;data_files&#39;. It&#39;s done to ensure</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># there&#39;s no contamination between requests, whilst giving time</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># enough to play with the data. Until a new request comes in.</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>        cmd <span class="op">=</span> <span class="ss">f&quot;/usr/bin/trash-put </span><span class="sc">{</span>datapth<span class="sc">}</span><span class="ss">/* 2&gt; /dev/null&quot;</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>        subprocess.run(cmd, shell<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># In this case, &#39;srch&#39; will be a two member tuple; the first, a</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># string with information, the second, a code to identify its</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>        <span class="co"># provenance. We only need the first. &#39;srch&#39; comes from &#39;pyfzf&#39;,</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>        <span class="co"># which means</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> srch[<span class="dv">0</span>]:</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>            <span class="co"># &#39;i&#39; is a tuple, but &#39;pyfzf&#39; passes it as string. We have to</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>            <span class="co"># convert it to tuple. That&#39;s what eval() is for.</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>            selection <span class="op">=</span> <span class="bu">eval</span>(i)</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>            <span class="co"># To ensure we looked thouroughly through &#39;Yay&#39;s database,</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>            <span class="co"># we&#39;ll try to look for packages in two of the ways they&#39;re</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>            <span class="co"># usually written. In this case, if the &#39;srch&#39; request has a</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>            <span class="co"># package that start&#39;s with &#39;python-&#39;:</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> selection[<span class="dv">1</span>].startswith(<span class="st">&quot;python-&quot;</span>):</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>                <span class="co"># We try with this name first.</span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>                flnm <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>selection[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>                subcall(shellcmd, flnm, fldr, flnmid, stderr)</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Then we&#39;ll check if the file created with its name has a</span></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>                <span class="co"># file size of 0. This means, most probably, that it didn&#39;t</span></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>                <span class="co"># find the package.</span></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> os.stat(<span class="ss">f&quot;</span><span class="sc">{</span>datapth<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>flnm<span class="sc">}{</span>flnmid<span class="sc">}</span><span class="ss">&quot;</span>).st_size <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># If it didn&#39;t find the package, we try to search for it</span></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># without the &quot;python-&quot; prefix.</span></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>                    flnm <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>selection[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">[7:]&quot;</span></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>                    subcall(shellcmd, flnm, fldr, flnmid, stderr)</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Here, regarding filename, it&#39;s the opposite of above. We</span></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>                <span class="co"># start with packages that don&#39;t have a &#39;python-&#39; prefix,</span></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>                <span class="co"># and try to add it if they fail to be found.</span></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>                flnm <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>selection[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>                subcall(shellcmd, flnm, fldr, flnmid, stderr)</span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> os.stat(<span class="ss">f&quot;</span><span class="sc">{</span>datapth<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>flnm<span class="sc">}{</span>flnmid<span class="sc">}</span><span class="ss">&quot;</span>).st_size <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>                    flnm <span class="op">=</span> <span class="ss">f&quot;python-</span><span class="sc">{</span>selection[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>                    subcall(shellcmd, flnm, fldr, flnmid, stderr)</span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># &#39;srch&#39; originating in &#39;required_by&#39;, will have a last entry called &#39;req&#39;.</span></span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> srch[<span class="op">-</span><span class="dv">1</span>] <span class="op">==</span> <span class="st">&quot;req&quot;</span>:</span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>        fldr <span class="op">=</span> <span class="st">&quot;required_files&quot;</span></span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>        datapth <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>da<span class="sc">}{</span>fldr<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>        <span class="co"># This deletes the contents of &#39;required_files&#39;. This is to ensure</span></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>        <span class="co"># there&#39;s no contamination between requests, whilst giving time</span></span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>        <span class="co"># enough time to play with the data. Until a new request comes in.</span></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>        cmd <span class="op">=</span> <span class="ss">f&quot;/usr/bin/trash-put </span><span class="sc">{</span>datapth<span class="sc">}</span><span class="ss">/* 2&gt; /dev/null&quot;</span></span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>        subprocess.run(cmd, shell<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>        <span class="co"># This makes it so we won&#39;t loop through the &#39;req&#39; entry.</span></span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> s <span class="kw">in</span> srch[:<span class="op">-</span><span class="dv">1</span>]:</span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>            <span class="co"># For notess on how &#39;flnm&#39; is defined, see above comments</span></span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>            <span class="co"># from lines 142 to 161.</span></span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> s[<span class="dv">0</span>].startswith(<span class="st">&quot;python-&quot;</span>):</span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>                flnm <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>s[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>                flnmid <span class="op">=</span> <span class="ss">f&quot;_</span><span class="sc">{</span>s[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>                subcall(shellcmd, flnm, fldr, flnmid, stderr)</span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> os.stat(<span class="ss">f&quot;</span><span class="sc">{</span>datapth<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>flnm<span class="sc">}{</span>flnmid<span class="sc">}</span><span class="ss">&quot;</span>).st_size <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>                    flnm <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>s[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">[7:]&quot;</span></span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>                    subcall(shellcmd, flnm, fldr, flnmid, stderr)</span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a>                flnm <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>s[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a>                flnmid <span class="op">=</span> <span class="ss">f&quot;_</span><span class="sc">{</span>s[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a>                subcall(shellcmd, flnm, fldr, flnmid, stderr)</span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> os.stat(<span class="ss">f&quot;</span><span class="sc">{</span>datapth<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>flnm<span class="sc">}{</span>flnmid<span class="sc">}</span><span class="ss">&quot;</span>).st_size <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a>                    flnm <span class="op">=</span> <span class="ss">f&quot;python-</span><span class="sc">{</span>s[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a>                    subcall(shellcmd, flnm, fldr, flnmid, stderr)</span></code></pre></div>
<h4>
<u>pip_info</u>
</h4>
<p>The same thing but for <em>pip</em>. And much simpler, thank God for
that.<br />
Just the fact that we don’t need to try two different title options,
makes everything much easier.</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> pip_info(srch):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Module to extract information on</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">    packages from &#39;pip&#39;.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    shellcmd <span class="op">=</span> <span class="st">&quot;pip show&quot;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    stderr <span class="op">=</span> <span class="st">&quot; 2&gt;&gt; error_files/pip_stderr.txt&quot;</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If &#39;srch&#39; comes from &#39;srch_allinfo&#39;, will need to evaluate the</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># output, as &#39;fzf&#39; presents tuples as strings. To id it,</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># &#39;srch_allinfo&#39; adds, at the end of &#39;srch&#39;, the string &#39;ai&#39;.</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># This way we&#39;ll know we can&#39;t process it without evaluating it.</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> srch[<span class="op">-</span><span class="dv">1</span>] <span class="op">==</span> <span class="st">&quot;ai&quot;</span>:</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        fldr <span class="op">=</span> <span class="st">&quot;data_files&quot;</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># In this case, &#39;srch&#39; will be two member tuple; the first, a</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># string with information, the second, a code to identify its</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># provenance. We only need the first.</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> srch[<span class="dv">0</span>]:</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>            selection <span class="op">=</span> <span class="bu">eval</span>(i)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>            flnm <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>selection[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>            flnmid <span class="op">=</span> <span class="st">&quot;_pip&quot;</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>            subcall(shellcmd, flnm, fldr, flnmid, stderr)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The &#39;req&#39; code tell &#39;s us that it&#39;s a request from &#39;required_by&#39;.</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># This means that is a list of tuples with a chosen package as</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># second member, and one of its dependencies as the first.</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> srch[<span class="op">-</span><span class="dv">1</span>] <span class="op">==</span> <span class="st">&quot;req&quot;</span>:</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>        fldr <span class="op">=</span> <span class="st">&quot;required_files&quot;</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># The last element of &#39;srch&#39; is the provenance code &#39;req&#39;.</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># We don&#39;t need it for this.</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> s <span class="kw">in</span> srch[:<span class="op">-</span><span class="dv">1</span>]:</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>            flnm <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>s[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>            flnmid <span class="op">=</span> <span class="ss">f&quot;_</span><span class="sc">{</span>s[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>            subcall(shellcmd, flnm, fldr, flnmid, stderr)</span></code></pre></div>
<h4>
<u>delete_all_files</u>
</h4>
<p>Last but by no means the least is <code>delete_all_files</code>,
which does more or less what it says in the title.<br />
The binary files that I created with abandon, as with much other cases
of profligacy, end up being a pollution problem.<br />
Not only they occupy real-estate, they interfere with any attempt to
read the updated versions.<br />
Cleanliness is necessary and virtuous.<br />
But we can’t delete too soon, even after showing the information to the
user. He might have more questions, so it must be kept until a new query
comes.<br />
This module is controlled by <code>main</code> and used in the end of
all processes.</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> delete_all_files():</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Deletes all binary files in present directory and &#39;mngmnt&#39;.</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    da <span class="op">=</span> os.getenv(<span class="st">&quot;DA&quot;</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    mn <span class="op">=</span> os.getenv(<span class="st">&quot;MN&quot;</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    cwd_fls <span class="op">=</span> os.listdir(da)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    mngmnt_fls <span class="op">=</span> os.listdir(mn)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    cwd_bins <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> cwd_fls <span class="cf">if</span> i.endswith(<span class="st">&quot;.bin&quot;</span>)]</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    mngmnt_bins <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> mngmnt_fls <span class="cf">if</span> i.endswith(<span class="st">&quot;.bin&quot;</span>)]</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> cwd_bins <span class="op">!=</span> []:</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> b <span class="kw">in</span> cwd_bins:</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>            os.remove(<span class="ss">f&quot;</span><span class="sc">{</span>da<span class="sc">}{</span>b<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> mngmnt_bins <span class="op">!=</span> []:</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> b <span class="kw">in</span> mngmnt_bins:</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>            os.remove(<span class="ss">f&quot;</span><span class="sc">{</span>mn<span class="sc">}{</span>b<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
</body>
</html>

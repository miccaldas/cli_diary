<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>I Have a Problem - Epilogue</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Iosevka;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        background-color: #232629;
        color: #7a7c7d;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #7a7c7d;  padding-left: 4px; }
    div.sourceCode
      { color: #cfcfc2; background-color: #232629; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #cfcfc2; } /* Normal */
    code span.al { color: #95da4c; background-color: #4d1f24; font-weight: bold; } /* Alert */
    code span.an { color: #3f8058; } /* Annotation */
    code span.at { color: #2980b9; } /* Attribute */
    code span.bn { color: #f67400; } /* BaseN */
    code span.bu { color: #7f8c8d; } /* BuiltIn */
    code span.cf { color: #fdbc4b; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #3daee9; } /* Char */
    code span.cn { color: #27aeae; font-weight: bold; } /* Constant */
    code span.co { color: #7a7c7d; } /* Comment */
    code span.cv { color: #7f8c8d; } /* CommentVar */
    code span.do { color: #a43340; } /* Documentation */
    code span.dt { color: #2980b9; } /* DataType */
    code span.dv { color: #f67400; } /* DecVal */
    code span.er { color: #da4453; text-decoration: underline; } /* Error */
    code span.ex { color: #0099ff; font-weight: bold; } /* Extension */
    code span.fl { color: #f67400; } /* Float */
    code span.fu { color: #8e44ad; } /* Function */
    code span.im { color: #27ae60; } /* Import */
    code span.in { color: #c45b00; } /* Information */
    code span.kw { color: #cfcfc2; font-weight: bold; } /* Keyword */
    code span.op { color: #cfcfc2; } /* Operator */
    code span.ot { color: #27ae60; } /* Other */
    code span.pp { color: #27ae60; } /* Preprocessor */
    code span.re { color: #2980b9; background-color: #153042; } /* RegionMarker */
    code span.sc { color: #3daee9; } /* SpecialChar */
    code span.ss { color: #da4453; } /* SpecialString */
    code span.st { color: #f44f4f; } /* String */
    code span.va { color: #27aeae; } /* Variable */
    code span.vs { color: #da4453; } /* VerbatimString */
    code span.wa { color: #da4453; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">I Have a Problem - Epilogue</h1>
</header>
<p>I might be a little hasty, but I would say that I got the automating of the SQLite database table sorted.<br />
I tried it a bunch of times and everything seems to be in order. I would be euphoric if it wasn’t this sinking feeling that I might’ve overlooked something.<br />
But I think that this is more the result of being so involved in solving this. This one took a toll on me.<br />
I was greatly misinformed <em>vis a vis</em> the relaxing qualities of pursuing an hobby.<br />
Maybe it’s just me that haven’t learned to relax yet. It’ll probably take another 48 years.<br />
So, if you remember or read the last post, I had two major problems, creating variables dynamically and finding the correct string manipulations that create a passable SQL query.<br />
In the end, I sidestepped the former and solved the latter.<br />
I was very ill at ease regarding the creation of dynamic variables. Everything and everyone that I found online said how bad an idea it is. And if it’s still not clear for me why this is worse than spitting on soup (a Portuguese saying to describe something that is morally wrong), but it was enough for me to spend some effort in finding a solution that wouldn’t go through that road. What I found is that I didn’t need to. Which corroborates the myriad of people that I found in Stack Overflow and its ilk, saying that one of the reasons for not doing it, was that there is always better solutions. I think I found one.<br />
Let me show you what I’ve done:</p>
<ol type="1">
<li>Here are my imports. I have <a href="https://docs.python.org/3/library/collections.html">collections</a> to create the ordered dict, <a href="https://docs.python.org/3/library/sqlite3.html">sqlite3</a> to make the calls to the database, <a href="https://pypi.org/project/Colr/">colr</a> because is very cool library to colorize terminal output, <a href="https://github.com/gruns/icecream">icecream</a> is just the sweetest thing and I love it, <a href="https://docs.python.org/3/library/re.html">re</a> is there for reasons that will become clear ahead.</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> collections</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> sqlite3</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="im">from</span> colr <span class="im">import</span> color</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="im">from</span> icecream <span class="im">import</span> ic</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> re</span></code></pre></div>
<ol start="2" type="1">
<li>Asking for the names of the database and its table:</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>  db_name <span class="op">=</span> <span class="bu">input</span>(color(<span class="st">&#39;What name do you want for the database? &#39;</span>, fore<span class="op">=</span><span class="st">&#39;#585a47&#39;</span>))</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  table_name <span class="op">=</span> <span class="bu">input</span>(color(<span class="st">&#39;What name do you want for the table? &#39;</span>, fore<span class="op">=</span><span class="st">&#39;#585a47&#39;</span>))</span></code></pre></div>
<ol start="3" type="1">
<li>Creating the database. Printing some strings just for peace of mind:</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span>:</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>      conn <span class="op">=</span> sqlite3.<span class="ex">connect</span>(db_name)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>      cur <span class="op">=</span> conn.cursor()</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>      ic(<span class="st">&quot;Database created and Successfully Connected to SQLite&quot;</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>      sqlite_select_Query <span class="op">=</span> <span class="st">&quot;select sqlite_version();&quot;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>      cur.execute(sqlite_select_Query)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>      record <span class="op">=</span> cur.fetchall()</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>      ic(<span class="st">&quot;SQLite Database Version is: &quot;</span>, record)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>      conn.commit()</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">except</span> sqlite3.Error <span class="im">as</span> e:</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>      ic(<span class="st">&quot;Error while connecting to db&quot;</span>, e)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">finally</span>:</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(conn):</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>          conn.close()</span></code></pre></div>
<ol start="4" type="1">
<li>Here, just as a refresher, is the code that collects the information about table structure from the users:</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>      a <span class="op">=</span> collections.OrderedDict()</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>      col_num <span class="op">=</span> <span class="bu">int</span>(<span class="bu">input</span>(color(<span class="st">&#39;How many columns will you need? &#39;</span>, fore<span class="op">=</span><span class="st">&#39;#ff6f69&#39;</span>)))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> y <span class="kw">in</span> <span class="bu">range</span>(col_num):</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>          col_name <span class="op">=</span> <span class="bu">input</span>(color(<span class="st">&#39;What is the name of your column? &#39;</span>, fore<span class="op">=</span><span class="st">&#39;#ff6f69&#39;</span>))</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>          key <span class="op">=</span> col_name</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>          a.setdefault(key, [])</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>          att_num <span class="op">=</span> <span class="bu">int</span>(<span class="bu">input</span>(color(<span class="st">&#39;How many attributes will you need? &#39;</span>, fore<span class="op">=</span><span class="st">&#39;#ff6f69&#39;</span>)))</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(att_num):</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>              att_name <span class="op">=</span> <span class="bu">input</span>(color(<span class="st">&#39;What is the name of your attribute? &#39;</span>, fore<span class="op">=</span><span class="st">&#39;#ff6f69&#39;</span>))</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>              a[key].append(att_name)</span></code></pre></div>
<ol start="5" type="1">
<li>Creating an empty list,</li>
</ol>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>  new <span class="op">=</span> []</span></code></pre></div>
<ol start="6" type="1">
<li>Opening a loop through the list that houses the answers to the questions of the last code block.</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> i <span class="kw">in</span> a:</span></code></pre></div>
<ol start="7" type="1">
<li>Separating the column name and its associates attributes into a specific list:</li>
</ol>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> (i, a[i])</span></code></pre></div>
<ol start="8" type="1">
<li>Aggregating the information separated by columns and respective attributes into a list of lists:</li>
</ol>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>  c <span class="op">=</span> <span class="bu">list</span>(b)</span></code></pre></div>
<ol start="9" type="1">
<li>Appending the columns name to a new list, as a string. The transformation to string is to have them prepared for the manipulations we’ll do briefly.</li>
</ol>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>  new.append(<span class="bu">str</span>(c[<span class="dv">0</span>]))</span></code></pre></div>
<ol start="10" type="1">
<li>Isolating the attributes part of the list as string.</li>
</ol>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>  d <span class="op">=</span> <span class="bu">str</span>(c[<span class="dv">1</span>])</span></code></pre></div>
<ol start="11" type="1">
<li>Replacing the comma between the attributes by a space.</li>
</ol>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>  e <span class="op">=</span> d.replace(<span class="st">&#39;,&#39;</span>, <span class="st">&#39;&#39;</span>)</span></code></pre></div>
<ol start="12" type="1">
<li>Aggregating the <em>commaless</em> attributes to the ‘new’ list.</li>
</ol>
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>  new.append(e)</span></code></pre></div>
<ol start="13" type="1">
<li>Transforming the list where you kept the column names and their attributes, after manipulation, into a string. ‘Corda’ in Portuguese, can mean ‘string’.</li>
</ol>
<div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>  corda <span class="op">=</span> <span class="bu">str</span>(new)</span></code></pre></div>
<ol start="14" type="1">
<li>We now create a new string but without the ‘[]““’}’ characters in it.</li>
</ol>
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>  cor1 <span class="op">=</span> corda.translate({<span class="bu">ord</span>(i): <span class="va">None</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="st">&#39;[]&quot;&quot;&#39;</span>})</span></code></pre></div>
<ol start="15" type="1">
<li>Another pass, to remove the apostrophes.</li>
</ol>
<div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>  cor2 <span class="op">=</span> cor1.translate({<span class="bu">ord</span>(i): <span class="va">None</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="st">&quot;&#39;&quot;</span>})</span></code></pre></div>
<ol start="16" type="1">
<li>Now we have the old problem, explained in detail in the last post, of what to do with the commas in the output. First we isolate the character in a variable.</li>
</ol>
<div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>  sub <span class="op">=</span> <span class="st">&#39;,&#39;</span></span></code></pre></div>
<ol start="17" type="1">
<li>Then we look for matches of commas in our clean string</li>
</ol>
<div class="sourceCode" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>  matches <span class="op">=</span> re.finditer(sub, cor2)</span></code></pre></div>
<ol start="18" type="1">
<li>We identify their indices, and keep them in a list.</li>
</ol>
<div class="sourceCode" id="cb18"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>  matches_positions <span class="op">=</span> [match.start() <span class="cf">for</span> match <span class="kw">in</span> matches]</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  oc <span class="op">=</span> matches_positions</span></code></pre></div>
<ol start="19" type="1">
<li>We noticed the following regularity in the distribution of the commas at this point. The first occurrence is there to separate the column name from its attributes, and we want to erase that one, the other is there to separate the list of attributes from the next key. And that we want to keep. So it’s necessary to delete commas, skipping one value and starting from 0. Because strings are immutable it is necessary to create another string that will house the indices to be replaced. For that, we use the following command:</li>
</ol>
<div class="sourceCode" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>  oc1 <span class="op">=</span> oc[<span class="dv">0</span>::<span class="dv">2</span>]</span></code></pre></div>
<ol start="20" type="1">
<li>We turn the string with the clean query into a list, so as to iterate through it.</li>
</ol>
<div class="sourceCode" id="cb20"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>  cor3 <span class="op">=</span> <span class="bu">list</span>(cor2)</span></code></pre></div>
<ol start="21" type="1">
<li>We open a iterator, setting as condition the indices on the list of the ones to replace.</li>
</ol>
<div class="sourceCode" id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> idx <span class="kw">in</span> oc1:</span></code></pre></div>
<ol start="22" type="1">
<li>Replacing the indices on the list of the query, with spaces, on the indexes that were marked in oc1.</li>
</ol>
<div class="sourceCode" id="cb22"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>  cor3[idx] <span class="op">=</span> <span class="st">&#39;&#39;</span></span></code></pre></div>
<ol start="23" type="1">
<li>Since we turned a string into a list, it separated all characters into different items. It’s needed to join them back again.</li>
</ol>
<div class="sourceCode" id="cb23"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>  cor4 <span class="op">=</span> <span class="st">&#39;&#39;</span>.join(cor3)</span></code></pre></div>
<ol start="24" type="1">
<li>Finally we define the structure of the query. This is what is going to be sent.</li>
</ol>
<div class="sourceCode" id="cb24"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>  query <span class="op">=</span> <span class="st">&#39;CREATE TABLE &#39;</span> <span class="op">+</span> table_name <span class="op">+</span> <span class="st">&#39;(&#39;</span> <span class="op">+</span> cor4 <span class="op">+</span> <span class="st">&#39;)&#39;</span></span></code></pre></div>
<ol start="25" type="1">
<li>And, at last, we send it to the database::</li>
</ol>
<div class="sourceCode" id="cb25"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>      <span class="cf">try</span>:</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>          conn <span class="op">=</span> sqlite3.<span class="ex">connect</span>(db_name)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>          cur <span class="op">=</span> conn.cursor()</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>          cur.execute(query)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>          conn.commit()</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>      <span class="cf">except</span> sqlite3.Error <span class="im">as</span> e:</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>          <span class="bu">print</span>(<span class="st">&quot;Error while connecting to db&quot;</span>, e)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>      <span class="cf">finally</span>:</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(conn):</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>              conn.close()</span></code></pre></div>
<p>This is what I’ve done. I believe that there’s still room for improvement. Many of these steps were separated so I could have a clearer understanding of what I was doing, as people who think as they go along tend to do.<br />
But that will be work for another time.<br />
One where I’ll be less scared of changing something and ruining it all.<br />
I’ll leave you with the complete code:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">&quot;&quot;&quot; This module creates a SQLite database and defines and uploads a new table for said database&quot;&quot;&quot;</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> collections</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> sqlite3</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="im">from</span> colr <span class="im">import</span> color</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="im">from</span> icecream <span class="im">import</span> ic</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> re</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  db_name <span class="op">=</span> <span class="bu">input</span>(color(<span class="st">&#39;What name do you want for the database? &#39;</span>, fore<span class="op">=</span><span class="st">&#39;#585a47&#39;</span>))</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  table_name <span class="op">=</span> <span class="bu">input</span>(color(<span class="st">&#39;What name do you want for the table? &#39;</span>, fore<span class="op">=</span><span class="st">&#39;#585a47&#39;</span>))</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span>:</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>      conn <span class="op">=</span> sqlite3.<span class="ex">connect</span>(db_name)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>      cur <span class="op">=</span> conn.cursor()</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>      ic(<span class="st">&quot;Database created and Successfully Connected to SQLite&quot;</span>)</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>      sqlite_select_Query <span class="op">=</span> <span class="st">&quot;select sqlite_version();&quot;</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>      cur.execute(sqlite_select_Query)</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>      record <span class="op">=</span> cur.fetchall()</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>      ic(<span class="st">&quot;SQLite Database Version is: &quot;</span>, record)</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>      conn.commit()</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">except</span> sqlite3.Error <span class="im">as</span> e:</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>      ic(<span class="st">&quot;Error while connecting to db&quot;</span>, e)</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">finally</span>:</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(conn):</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>          conn.close()</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> collect_data():</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>      <span class="co">&quot;&quot;&quot; Here we ask the user the information needed to create a table, then we process the output until is fit to be a SQL query, and uploaded it to the db&quot;&quot;&quot;</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>      a <span class="op">=</span> collections.OrderedDict()</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>      col_num <span class="op">=</span> <span class="bu">int</span>(<span class="bu">input</span>(color(<span class="st">&#39;How many columns will you need? &#39;</span>, fore<span class="op">=</span><span class="st">&#39;#ff6f69&#39;</span>)))</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> y <span class="kw">in</span> <span class="bu">range</span>(col_num):</span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>          col_name <span class="op">=</span> <span class="bu">input</span>(color(<span class="st">&#39;What is the name of your column? &#39;</span>, fore<span class="op">=</span><span class="st">&#39;#ff6f69&#39;</span>))</span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>          key <span class="op">=</span> col_name</span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>          a.setdefault(key, [])</span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>          att_num <span class="op">=</span> <span class="bu">int</span>(<span class="bu">input</span>(color(<span class="st">&#39;How many attributes will you need? &#39;</span>, fore<span class="op">=</span><span class="st">&#39;#ff6f69&#39;</span>)))</span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(att_num):</span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a>              att_name <span class="op">=</span> <span class="bu">input</span>(color(<span class="st">&#39;What is the name of your attribute? &#39;</span>, fore<span class="op">=</span><span class="st">&#39;#ff6f69&#39;</span>))</span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a>              a[key].append(att_name)</span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>      new <span class="op">=</span> []</span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> i <span class="kw">in</span> a:</span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a>          b <span class="op">=</span> (i, a[i])</span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>          <span class="bu">print</span>(b)</span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a>          c <span class="op">=</span> <span class="bu">list</span>(b)</span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a>          <span class="bu">print</span>(c)</span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a>          new.append(<span class="bu">str</span>(c[<span class="dv">0</span>]))</span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a>          <span class="bu">print</span>(new)</span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a>          d <span class="op">=</span> <span class="bu">str</span>(c[<span class="dv">1</span>])</span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a>          <span class="bu">print</span>(d)</span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a>          e <span class="op">=</span> d.replace(<span class="st">&#39;,&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a>          <span class="bu">print</span>(e)</span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a>          new.append(e)</span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(new)</span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a>      corda <span class="op">=</span> <span class="bu">str</span>(new)</span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a>      cor1 <span class="op">=</span> corda.translate({<span class="bu">ord</span>(i): <span class="va">None</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="st">&#39;[]&quot;&quot;&#39;</span>})</span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a>      cor2 <span class="op">=</span> cor1.translate({<span class="bu">ord</span>(i): <span class="va">None</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="st">&quot;&#39;&quot;</span>})</span>
<span id="cb26-58"><a href="#cb26-58" aria-hidden="true" tabindex="-1"></a>      sub <span class="op">=</span> <span class="st">&#39;,&#39;</span></span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true" tabindex="-1"></a>      matches <span class="op">=</span> re.finditer(sub, cor2)</span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true" tabindex="-1"></a>      matches_positions <span class="op">=</span> [match.start() <span class="cf">for</span> match <span class="kw">in</span> matches]</span>
<span id="cb26-61"><a href="#cb26-61" aria-hidden="true" tabindex="-1"></a>      oc <span class="op">=</span> matches_positions</span>
<span id="cb26-62"><a href="#cb26-62" aria-hidden="true" tabindex="-1"></a>      oc1 <span class="op">=</span> oc[<span class="dv">0</span>::<span class="dv">2</span>]</span>
<span id="cb26-63"><a href="#cb26-63" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(<span class="st">&#39;oc1 = &#39;</span>, oc1)</span>
<span id="cb26-64"><a href="#cb26-64" aria-hidden="true" tabindex="-1"></a>      cor3 <span class="op">=</span> <span class="bu">list</span>(cor2)</span>
<span id="cb26-65"><a href="#cb26-65" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> idx <span class="kw">in</span> oc1:</span>
<span id="cb26-66"><a href="#cb26-66" aria-hidden="true" tabindex="-1"></a>          cor3[idx] <span class="op">=</span> <span class="st">&#39;&#39;</span></span>
<span id="cb26-67"><a href="#cb26-67" aria-hidden="true" tabindex="-1"></a>      cor4 <span class="op">=</span> <span class="st">&#39;&#39;</span>.join(cor3)</span>
<span id="cb26-68"><a href="#cb26-68" aria-hidden="true" tabindex="-1"></a>      query <span class="op">=</span> <span class="st">&#39;CREATE TABLE &#39;</span> <span class="op">+</span> table_name <span class="op">+</span> <span class="st">&#39;(&#39;</span> <span class="op">+</span> cor4 <span class="op">+</span> <span class="st">&#39;)&#39;</span></span>
<span id="cb26-69"><a href="#cb26-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-70"><a href="#cb26-70" aria-hidden="true" tabindex="-1"></a>      <span class="cf">try</span>:</span>
<span id="cb26-71"><a href="#cb26-71" aria-hidden="true" tabindex="-1"></a>          conn <span class="op">=</span> sqlite3.<span class="ex">connect</span>(db_name)</span>
<span id="cb26-72"><a href="#cb26-72" aria-hidden="true" tabindex="-1"></a>          cur <span class="op">=</span> conn.cursor()</span>
<span id="cb26-73"><a href="#cb26-73" aria-hidden="true" tabindex="-1"></a>          cur.execute(query)</span>
<span id="cb26-74"><a href="#cb26-74" aria-hidden="true" tabindex="-1"></a>          conn.commit()</span>
<span id="cb26-75"><a href="#cb26-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-76"><a href="#cb26-76" aria-hidden="true" tabindex="-1"></a>      <span class="cf">except</span> sqlite3.Error <span class="im">as</span> e:</span>
<span id="cb26-77"><a href="#cb26-77" aria-hidden="true" tabindex="-1"></a>          <span class="bu">print</span>(<span class="st">&quot;Error while connecting to db&quot;</span>, e)</span>
<span id="cb26-78"><a href="#cb26-78" aria-hidden="true" tabindex="-1"></a>      <span class="cf">finally</span>:</span>
<span id="cb26-79"><a href="#cb26-79" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(conn):</span>
<span id="cb26-80"><a href="#cb26-80" aria-hidden="true" tabindex="-1"></a>              conn.close()</span>
<span id="cb26-81"><a href="#cb26-81" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-82"><a href="#cb26-82" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-83"><a href="#cb26-83" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&#39;__main__&#39;</span>:</span>
<span id="cb26-84"><a href="#cb26-84" aria-hidden="true" tabindex="-1"></a>      collect_data()</span></code></pre></div>
</body>
</html>

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Bash Scripts for Cli Diary</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Iosevka;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #cccccc; background-color: #303030; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ffcfaf; } /* Alert */
    code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
    code span.at { } /* Attribute */
    code span.bn { color: #dca3a3; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #f0dfaf; } /* ControlFlow */
    code span.ch { color: #dca3a3; } /* Char */
    code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
    code span.co { color: #7f9f7f; } /* Comment */
    code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
    code span.do { color: #7f9f7f; } /* Documentation */
    code span.dt { color: #dfdfbf; } /* DataType */
    code span.dv { color: #dcdccc; } /* DecVal */
    code span.er { color: #c3bf9f; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #c0bed1; } /* Float */
    code span.fu { color: #efef8f; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
    code span.kw { color: #f0dfaf; } /* Keyword */
    code span.op { color: #f0efd0; } /* Operator */
    code span.ot { color: #efef8f; } /* Other */
    code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
    code span.sc { color: #dca3a3; } /* SpecialChar */
    code span.ss { color: #cc9393; } /* SpecialString */
    code span.st { color: #cc9393; } /* String */
    code span.va { } /* Variable */
    code span.vs { color: #cc9393; } /* VerbatimString */
    code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Bash Scripts for Cli Diary</h1>
</header>
<p>When I started the cli diary project I didn’t have very clear ideas about what I was going to do. Because of this, there were a lot of things I did that ended up in the bin.<br />
But, although they don’t make part of the finished product, I still learned some interesting things doing them.<br />
Case in point, because I wanted to access the Python blog posts through the diary, I needed to bulk collect and rename the files. I thought best to work from the html files directly, but the way they were stored by Hexo is by giving the title of the post to the folder housing the html file and name them all ‘index.html’.<br />
So I needed to name the files proper.<br />
To do this I built the following script:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a> <span class="va">collection</span><span class="op">=</span>/home/mic/python/cli_diary/cli_diary/blog_posts/collection/<span class="pp">*</span></span></code></pre></div>
<p>This is where I stored all the html files. For ease of use I turned it to a variable. Note the use of ’*’ at the end of the link. That tells the shell that we are referencing the files within the folder and not the folder itself.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> file <span class="kw">in</span> <span class="va">${collection}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>     <span class="va">name</span><span class="op">=</span><span class="va">$(</span><span class="fu">sed</span> <span class="at">-n</span> <span class="at">-r</span> <span class="st">&quot;s/^.*&lt;p class=</span><span class="dt">\&quot;</span><span class="st">post-title</span><span class="dt">\&quot;</span><span class="st">&gt;(.*)&lt;\x2fp&gt;&lt;\x2fh2&gt;.*$/\1/p1&quot;</span> <span class="va">${file})</span></span></code></pre></div>
<p>Here we iterate through the html files and create a variable from a Sed command.<br />
To create a variable from a command in bash, you envelop the command with <code>$(...)</code>.<br />
The post title was defined inside the file as a tag with the class ‘post-title’, I needed to retrieve its value.<br />
This is what the command does: 1. <code>^.*&lt;p class=\*post-title\*&gt;</code> indicates everything from the beginning of a line to the p tag. The ’“’ needed to be escaped.<br />
2. <code>(.*)</code> defines a group of characters beginning after the content of point 1 up to … 3. this expression, <code>&lt;\x2fp&gt;&lt;\x2fh2&gt;.*$/</code>, where <code>\x2f</code> is a hex code for”/“, and it also needed to be escaped.<br />
4. <code>\1</code> defines the selection as the group from the previous expression.<br />
5. <code>p1</code> tells Sed to print the first occurrence of the selection.<br />
6. <code>${file}</code> defines that the text to be analyzed is the current iterated file.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a> <span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$name</span><span class="st">&quot;</span></span></code></pre></div>
<p>Here we print the result of the ‘name’ variable.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a> <span class="va">dash</span><span class="op">=</span><span class="va">$(</span><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$name</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">sed</span> <span class="at">-re</span> <span class="st">&quot;s/ /_/g&quot;</span> <span class="kw">|</span> <span class="fu">tr</span> [:upper:] [:lower:]<span class="va">)</span></span></code></pre></div>
<p>The ‘dash’ variable will define the new titles by piping the printed ‘name’ variable to Sed that will replace all spaces in ‘name’ by ’_’. Finally the result of the Sed command will be piped to tr, that will convert uppercase characters to lowercase.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a> <span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$dash</span><span class="st">&quot;</span></span></code></pre></div>
<p>Here we print the result of the ‘dash’ variable.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">cp</span> <span class="at">-r</span> <span class="va">${file}</span> new_titles/<span class="st">&quot;</span><span class="va">$dash</span><span class="st">&quot;</span>.html</span></code></pre></div>
<p>Finally we copy the content of the file to a new folder called ‘new_titles’, with the variable ‘dash’ concatenated with ‘.html’ as title.</p>
<p>As the post files were all in their individual folders, encased in other folders that divided by month, it was needed to concentrate them in one folder, for ease of use.<br />
For that I used the following script:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">find</span> /home/mic/python/cli_diary/cli_diary/blog_posts/2021 <span class="at">-type</span> f <span class="at">-exec</span> cp <span class="at">--backup</span><span class="op">=</span>numbered <span class="at">-t</span> /home/mic/python/cli_diary/cli_diary/blog_posts/collection {} +</span></code></pre></div>
<p>First we define where to start the search. <code>find</code> will search inside all subfolders.<br />
<code>-type f</code> defines that the objective is files only.<br />
<code>exec cp</code> executes the copy command.<br />
<code>--backup=numbered</code> defines how it’ll name the new files.<br />
<code>-t</code> defines the destination folder.<br />
<code>{} +</code>, I have no idea what it does.</p>
</body>
</html>

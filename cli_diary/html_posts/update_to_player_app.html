<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Update to Player App</title>
  <style>
    html {
      font-family: Iosevka;
      font-size: 13pt;
      color: #1a1a1a;
      background-color: #fdfdfd;
      line-height: 1.5;
    }
    body {
      margin: 0 auto;
      max-width: 45em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
     pre.sourceCode { margin: 1em; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #cccccc; background-color: #303030; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ffcfaf; } /* Alert */
    code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
    code span.at { } /* Attribute */
    code span.bn { color: #dca3a3; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #f0dfaf; } /* ControlFlow */
    code span.ch { color: #dca3a3; } /* Char */
    code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
    code span.co { color: #7f9f7f; } /* Comment */
    code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
    code span.do { color: #7f9f7f; } /* Documentation */
    code span.dt { color: #dfdfbf; } /* DataType */
    code span.dv { color: #dcdccc; } /* DecVal */
    code span.er { color: #c3bf9f; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #c0bed1; } /* Float */
    code span.fu { color: #efef8f; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
    code span.kw { color: #f0dfaf; } /* Keyword */
    code span.op { color: #f0efd0; } /* Operator */
    code span.ot { color: #efef8f; } /* Other */
    code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
    code span.sc { color: #dca3a3; } /* SpecialChar */
    code span.ss { color: #cc9393; } /* SpecialString */
    code span.st { color: #cc9393; } /* String */
    code span.va { } /* Variable */
    code span.vs { color: #cc9393; } /* VerbatimString */
    code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Update to Player App</h1>
<p class="date">21-07-2023 22:03</p>
</header>
I did some housekeeping to the <em>player</em> app. I neglected it for a
while but, needing a project, found it again.<br />
The major alterations were:<br />

<h3>
Commands.
</h3>
<p>The old ones were rickety and unstable, this ones, although as simple
as they could get, are much more robust. I took notice that the <a
href="https://blessed.readthedocs.io/en/latest/">Blessed</a>, the cli
framework, has support for keyboard commands. But that is not how I got
to this idea. What woke me up to the need for audio keyboard commands,
was the fact that my columns stopped working and, with that, i had no
easy way to, say, control the volume. As I use <a
href="https://archlinux.org">Arch</a>, my audio setup is made of <a
href="https://wiki.archlinux.org/title/Advanced_Linux_Sound_Architecture">ALSA</a>
and <a
href="https://wiki.archlinux.org/title/PulseAudio">PulseAudio</a>. The
first one has direct connection to the kernel and is developed by Linux.
The latter is a sound server that works as middle layer between ALSA and
client applications.<br />
Both have rudimentary tools to manage sound streaming and, I’m very fond
of not installing anything new if the old stuff does the job, I ended up
using ALSA’s <em>alsamixer</em> tool to manage audio. The simplicity and
depth of working with something at such a basic level, gave me a feeling
of confidence. I created very simple shell scripts for he
commands.<br />
Like this:</p>
<p><strong>Lowering Volume:</strong></p>
<p><code>**amixer set Master 10%- &gt; /dev/null 2&gt;&amp;1**</code></p>
<p><strong>Raising Volume:</strong></p>
<p><code>**amixer set Master 10%+ &gt; /dev/null 2&gt;&amp;1**</code></p>
<p><strong>Mute Volume:</strong></p>
<p><code>**amixer set Master toggle &gt; /dev/null 2&gt;&amp;1**</code></p>
<p>With the scripts built, it was just the case of binding them to a
keyboard sequence.<br />
Later I created a script to stop the music player. It looks for a
process originated by <em>player.py</em> in the <em>player</em>
folder,and kills it:</p>
<p><code>**cd /home/mic/python/player/player/**</code>
<code>**sudo kill -9 pgrep -f player.py &gt; /dev/null 2&gt;&amp;1**</code></p>
<p>As my shell is <a href="https://zsh.sourceforge.io">Zsh</a>, I used
its tool <em>zsh-edit</em>, to create the keybinds:</p>
<p><strong>Raising Volume - Keybind ‘F6’</strong></p>
<p><code>**bind '^[[17~' ~/scripts/raisevolume.sh**</code></p>
<p><strong>Lowering Volume - Keybind ‘F7’</strong></p>
<p><code>**bind '^[[18~' ~/scripts/lowervolumne.sh**</code></p>
<p><strong>Mute Sound - Keybind ‘F8’</strong></p>
<p><code>**bind '^[[19~' ~/scripts/mutevolume.sh**</code></p>
<p><strong>Stop Player - Keybind ‘Ctrl-Alt-p’</strong></p>
<p><code>**bind '^[^P' ~/scripts/player_pid.sh**</code></p>
<p>To discover what codes are used by what keys, I used the very useful
and simple <a
href="https://man7.org/linux/man-pages/man1/showkey.1.html">showkey</a>
command. People will suggest other things, like <em>Xev</em> and what
have you, but they tend to open unnecessary windows and superfluous
information. Stick to <em>showkey</em> and you won’t be led astray.</p>
<h3>
Search
</h3>
<p>In the old version, to get to the music you wanted, it would get
complete paths to each album, print them, and the user would need to
copy/paste them. Here we tried something more friendly with a
<code>choose.py</code> module.<br />
We’re using Blessed to prettify the output and also because it has
simple ways of interacting with keybinds.<br />
The idea is pretty basic, you’re first directed to upper folder where
the music collection is. There you choose a musician. This is glued to
the rest of the path, now with the path for the chosen artist, and fed
again to the <em>choose</em> module, that’ll print the content of said
folder; consisting mainly of several albums by an artist. Here the user
chooses the album. And with that we have a complete path to a chosen
album, to feed the music player.<br />
The module is heavily commentated and speaks for itself. Here it is:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">    Module to show the contents of the music folder, and collect user&#39;s choice.</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> os</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> pickle</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> snoop</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> blessed <span class="im">import</span> Terminal</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> snoop <span class="im">import</span> pp</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> type_watch(source, value):</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f&quot;type(</span><span class="sc">{</span>source<span class="sc">}</span><span class="ss">)&quot;</span>, <span class="bu">type</span>(value)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    snoop.install(out<span class="op">=</span><span class="st">&quot;logs&quot;</span>, overwrite<span class="op">=</span><span class="va">True</span>, watch_extras<span class="op">=</span>[type_watch])</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">@snoop</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> choose(content):</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co">        Presents the content of a folder. Returns an entry id.</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co">        &quot;&quot;&quot;</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>        content_list <span class="op">=</span> os.listdir(content)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Integer with the length of the longest album name.</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>        longest <span class="op">=</span> <span class="bu">len</span>(<span class="bu">max</span>(content_list))</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>        choicelst <span class="op">=</span> []</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> content.endswith(<span class="st">&quot;music&quot;</span>):</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>            title <span class="op">=</span> <span class="st">&quot;CHOOSE AN ARTIST&quot;</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>            title <span class="op">=</span> <span class="st">&quot;CHOOSE AN ALBUM&quot;</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>        heights <span class="op">=</span> []</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>        term <span class="op">=</span> Terminal()</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># To center the album entries, we divide the screen width/height by two, and</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>        <span class="co"># from that number, subtract the value of &#39;longest&#39; entry, for width, ang entries</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>        <span class="co"># length, for height.</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># wdth = int((term.width - longest) / 2)</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>        wdth <span class="op">=</span> <span class="bu">int</span>(term.width <span class="op">/</span> <span class="dv">4</span>)</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>        <span class="co"># The initial height is found by first finding the number of lines of the text will</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>        <span class="co"># use. That means, the length of the list of albums, two lines for the title and its</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>        <span class="co"># separator and two lines for the exit message and its separator. We subtract this</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>        <span class="co"># from the height of the screen, if we didn&#39;t, the text would like it started too</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># low in the screen. Finally we divide the result by two.</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>        ht <span class="op">=</span> <span class="bu">int</span>((term.height <span class="op">-</span> (<span class="bu">len</span>(content_list) <span class="op">+</span> <span class="dv">4</span>)) <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculates the title&#39;s width, it uses the block of text initial width, looks for</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>        <span class="co"># the longest line there, divides it by two and adds the halved number to the</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>        <span class="co"># initial width.</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>        twdth <span class="op">=</span> wdth <span class="op">+</span> <span class="bu">int</span>(longest <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>        <span class="co"># In order to define the height of each entry, we use &#39;enumerate&#39; to create a</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>        <span class="co"># new list. The first element is an integer version of id, so we can use it defining</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>        <span class="co"># entry height and choosing what to play. The string version of the id serves as an</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>        <span class="co"># identifer for the user.</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>        albums <span class="op">=</span> [[f, <span class="bu">str</span>(f) <span class="op">+</span> <span class="st">&quot; - &quot;</span> <span class="op">+</span> <span class="st">&quot;&quot;</span>.join(i)] <span class="cf">for</span> f, i <span class="kw">in</span> <span class="bu">enumerate</span>(content_list)]</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>        <span class="co"># &#39;fullscreen&#39; permits to restore the terminal screen to exactly how it was before</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>        <span class="co"># entering the &#39;player&#39; app. Without it, the content of the app, although not</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>        <span class="co"># usable, would still be visible after exit. &#39;cbreak&#39; registers individual keyboard</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>        <span class="co"># clicks. While inside this context manager, it&#39;ll log all keypresses.</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> term.fullscreen(), term.cbreak():</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Clears, prepares, defines background/foreground colors, for the screen.</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(term.move <span class="op">+</span> term.black_on_peachpuff <span class="op">+</span> term.bold <span class="op">+</span> term.clear, end<span class="op">=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>            <span class="co"># The title height is the text block initial height minus one for the title and</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>            <span class="co"># one more for the seprator</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(term.move_xy(twdth, (ht <span class="op">-</span> <span class="dv">2</span>)) <span class="op">+</span> title)</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>            <span class="co"># To ensure that the album entries stack one after the other verticallly, we use</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>            <span class="co"># the &#39;idx&#39; value, that starts at 0, and add it to the initial height of the</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>            <span class="co"># entries. We register these heights in a list called &quot;heights&quot;.</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> album <span class="kw">in</span> albums:</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>                hght <span class="op">=</span> ht <span class="op">+</span> album[<span class="dv">0</span>]</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>                heights.append(hght)</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(term.move_xy(wdth, hght) <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>.join(term.wrap(album[<span class="dv">1</span>])))</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>            <span class="co"># To define the height of the exit information line, as below the the text block</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>            <span class="co"># plus a sperator line and the line proper; we get the last value in the</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>            <span class="co"># &#39;heights&#39; list, corresponding to the height of the last entry, and add two.</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>            exitht <span class="op">=</span> heights[<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> <span class="dv">2</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(term.move_xy(wdth, exitht) <span class="op">+</span> <span class="st">&quot;Press &#39;e&#39; to exit after choosing. Press &#39;q&#39; to exit this screen.&quot;</span>)</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Here to assure we can access &#39;inpt&#39; value outside the loop.</span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>            inpt <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>            <span class="co"># While there&#39;s no exit call...</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> inpt.lower() <span class="op">!=</span> <span class="st">&quot;q&quot;</span>:</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>                <span class="co"># the variable will collect clicked keyboard keys names.</span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>                inpt <span class="op">=</span> term.inkey()</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>                <span class="co"># If we used the &#39;q&#39; key to exit this loop, besides the key intended to press</span></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>                <span class="co"># it would add &#39;q&#39; from the exit command. To avoid this, we create a loop</span></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>                <span class="co"># that runs while no one presses &#39;e&#39;, creating a exit command to the loop</span></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>                <span class="co"># alone but, as there is no more code ahed except a &#39;return&#39; statement, it</span></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>                <span class="co"># in effect closes the program.</span></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> inpt <span class="op">!=</span> <span class="st">&quot;e&quot;</span>:</span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># We collect keypresses in a list...</span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>                    choicelst.append(<span class="bu">str</span>(inpt))</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># if there&#39;s more than one, we add append it to the previous one. This</span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># way we&#39;re able to collect two digit numbers.</span></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>                    chcstr <span class="op">=</span> <span class="st">&quot;&quot;</span>.join(choicelst)</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># To compare input result with the idx from the enumerated list.</span></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># chc = int(chcstr)</span></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> chcstr:</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>                        choice <span class="op">=</span> [i <span class="cf">for</span> f, i <span class="kw">in</span> <span class="bu">enumerate</span>(content_list) <span class="cf">if</span> f <span class="op">==</span> <span class="bu">int</span>(chcstr)]</span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">with</span> <span class="bu">open</span>(<span class="st">&quot;choice.bin&quot;</span>, <span class="st">&quot;wb&quot;</span>) <span class="im">as</span> f:</span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>                        pickle.dump(choice, f)</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span></code></pre></div>
<h3>
Music Player.
</h3>
<p>Here I purposefully went for the simpler available option. Even
risking too simple.<br />
<a href="https://pypi.org/project/playsound/">Playsound</a> has only one
command, which is to play a file. This command has one boolean argument,
to use it on blocking mode or not. As using the non-blocking mode
doesn’t work, that’s even one less thing to worry about. The other audio
libraries are oriented for a type of in-depth use that’s not my case.
Add to that an irritating habit of spewing unneeded output whilst
playing a file, and I was looking for something much more clean and
direct.<br />
The only thing I miss that I could have with other players, is the
ability to fast-forward and rewind. But not enough to get used to a
constant barrage of information diarrhea.<br />
Marvel at the spartan beauty of the player’s function:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>    <span class="at">@snoop</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> player():</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">        &#39;Playsound&#39; is the simplest player I</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">        know. It has only one argument, &#39;block&#39;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">        which is boolean that determines if the</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">        Playsound&#39;s execution is blocking or not.</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">        When I tried it as not blocking it</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">        wouldn&#39;t work.</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">        &quot;&quot;&quot;</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(<span class="st">&quot;song.bin&quot;</span>, <span class="st">&quot;rb&quot;</span>) <span class="im">as</span> f:</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>            song <span class="op">=</span> pickle.load(f)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>        playsound(song)</span></code></pre></div>
<h3>
Ticker.
</h3>
<p>What I wanted, really, was a progress bar. Something that would tell
me how long I still have to wait for a music to stop, be a harmless
source of visual interest and nothing more.<br />
I used <a href="https://github.com/tqdm/tqdm">Tqdm</a>, that I had used
before, after trying a lot of other alternatives, and will use again as
it seems the better solution for cli progress bars.<br />
The way I used bars before, and wanted to continue using, was to make
them loop through the range of the music’s duration. But now the player
didn’t had that information to divulge. What to do?<br />
I started thinking about metadata on how to extract it and, finally, I
discovered that a library I had installed, <a
href="https://github.com/kkroening/ffmpeg-python">ffmpeg-python</a>, had
exactly what I wanted.<br />
<em>ffmpeg-probe</em> gets all metadata in a video file. As I download
everything from Youtube, although I download only the audio, they’re
still mp4 files. The information is in one dictionary inside a list
called <em>streams</em>, and you fetch it as in any other dictionary
inside a list. Below see, first, the function that fetches the metadata
and, after, the code that launches the player and the progress bar. It’s
multi-threaded so the ticker runs at the same time as the player:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> duration():</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">        We use &#39;ffmpeg&#39; to get metadata about the</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">        duration of musics. If there&#39;s nothing in</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">        &#39;duration&#39;, we&#39;ll assume the song is about</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">        three minutes long. This information is</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">        used by Tqdm.</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">        &quot;&quot;&quot;</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(<span class="st">&quot;song.bin&quot;</span>, <span class="st">&quot;rb&quot;</span>) <span class="im">as</span> g:</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>            length <span class="op">=</span> pickle.load(g)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># The metadata is kept in a list called &#39;streams&#39;, that</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># houses a dictionary with the information. To search it</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># know that there is only the dictionary below the list,</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># so it&#39;s just a case of [&#39;stream&#39;][0][&lt;metada_you_want&gt;]</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>        duration <span class="op">=</span> ffmpeg.probe(length)[<span class="st">&quot;streams&quot;</span>][<span class="dv">0</span>][<span class="st">&quot;duration&quot;</span>]</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> duration:</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> duration</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>            duration <span class="op">=</span> <span class="dv">224</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> duration</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> ticker():</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">        The program should present the content of the &#39;music&#39; folder,</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">        create a prompt for the user to choose from, and reproduce the files</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">        with a timer.</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">        &#39;F6&#39; - Lowers the volume,</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">        &#39;F7&#39; - Raises it,</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">        &#39;F8&#39; - Mutes it.</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">        &#39;Ctrl-Alt-p&#39; - Stops the player.</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">        &quot;&quot;&quot;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>        dur <span class="op">=</span> duration()</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        drt <span class="op">=</span> <span class="bu">float</span>(dur)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>        drtn <span class="op">=</span> <span class="bu">int</span>(drt)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>        console <span class="op">=</span> Console()</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>        console.<span class="bu">print</span>(</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;&quot;[bold #E9B384]</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="st">      ############################</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="st">      ##    MUSIC PLAYER        ##</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="st">      ############################</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="st">      ##     Louder - &#39;F7&#39;      ##</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="st">      ##     Lower  - &#39;F6&#39;      ##</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="st">      ##     Mute   - &#39;F8&#39;      ##</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="st">      ##  Stop   - &#39;Ctrl-Alt-p&#39; ##</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="st">      ############################</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="st">      [/]</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="st">                &quot;&quot;&quot;</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> tqdm(</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>            <span class="bu">range</span>(drtn),</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>            position<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>            ncols<span class="op">=</span><span class="dv">70</span>,</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>            colour<span class="op">=</span><span class="st">&quot;yellow&quot;</span>,</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>            bar_format<span class="op">=</span><span class="st">&quot;</span><span class="sc">{percentage:3.0f}</span><span class="st">%|</span><span class="sc">{bar}</span><span class="st">| </span><span class="sc">{remaining}</span><span class="st">]&quot;</span>,</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>        ):</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>            sleep(<span class="dv">1</span>)</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>        t1 <span class="op">=</span> threading.Thread(target<span class="op">=</span>ticker)</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>        t2 <span class="op">=</span> threading.Thread(target<span class="op">=</span>player)</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>        t1.start()</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>        t2.start()</span></code></pre></div>
</body>
</html>
